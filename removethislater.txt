timestamp:wait-for-startup
Re-running sockettest.sh with valgrind
~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/server ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/assignment-autotest/test/assignment6 ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro
~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/assignment-autotest/test/assignment6 ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/server ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/assignment-autotest/test/assignment6 ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro
Starting valgrind
Waiting for aesdsocket application to start
aesdsocket[2801434]: Accepted connection from 127.0.0.1
aesdsocket[2801434]: Received full data packet from 127.0.0.1
timestamp:wait-for-startup
aesdsocket[2801434]: Closed connection from 127.0.0.1
Testing target localhost on port 9000
sending string abcdefg
aesdsocket[2801434]: Accepted connection from 127.0.0.1
aesdsocket[2801434]: Received full data packet from 127.0.0.1
aesdsocket[2801434]: Closed connection from 127.0.0.1
Differences found after sending abcdefg to localhost on port 9000
Expected contents to match:
abcdefg
But found contents:
abcdefg
hijklmnop
1234567890
9876543210
One best book is equal to a hundred good friends, but one good friend is equal to a library
If you want to shine like a sun, first burn like a sun
Never stop fighting until you arrive at your destined place - that is, the unique you
Never stop fighting until you arrive at your destined place - that is, the unique you
One best book is equal to a hundred good friends, but one good friend is equal to a library
One best book is equal to a hundred good friends, but one good friend is equal to a library
If you want to shine like a sun, first burn like a sun
Never stop fighting until you arrive at your destined place - that is, the unique you
If you want to shine like a sun, first burn like a sun
validate_multithreaded
test_socket_timer
test_socket_timer
timestamp:wait-for-startup
abcdefg
With differences
--- /tmp/fileuaxG2Z     2024-05-22 00:17:52.542392186 +0000
+++ /tmp/fileQF59NO     2024-05-22 00:17:51.530405578 +0000
@@ -1 +1,18 @@
 abcdefg
+hijklmnop
+1234567890
+9876543210
+One best book is equal to a hundred good friends, but one good friend is equal to a library
+If you want to shine like a sun, first burn like a sun
+Never stop fighting until you arrive at your destined place - that is, the unique you
+Never stop fighting until you arrive at your destined place - that is, the unique you
+One best book is equal to a hundred good friends, but one good friend is equal to a library
+One best book is equal to a hundred good friends, but one good friend is equal to a library
+If you want to shine like a sun, first burn like a sun
+Never stop fighting until you arrive at your destined place - that is, the unique you
+If you want to shine like a sun, first burn like a sun
+validate_multithreaded
+test_socket_timer
+test_socket_timer
+timestamp:wait-for-startup
+abcdefg
Test complete with failure. Make sure you have restarted the socket server before starting this script
Validation Error:sockettest.sh returned 1 attempting to run against native compiled aesdsocket instance running under valgrind
Stopping valgrind and aesdsocket process at pid 2801434
Waiting for aesdsocket and valgrind to exit
aesdsocket[2801434]: Caught signal, exiting
Valgrind and aesdsocket complete
Validation Error:Valgrind failed with 1
Valgrind output error log:
==2801434== Memcheck, a memory error detector
==2801434== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==2801434== Using Valgrind-3.15.0-608cb11914-20190413 and LibVEX; rerun with -h for copyright info
==2801434== Command: ./aesdsocket
==2801434== Parent PID: 2801432
==2801434==
--2801434--
--2801434-- Valgrind options:
--2801434--    --error-exitcode=1
--2801434--    --leak-check=full
--2801434--    --show-leak-kinds=all
--2801434--    --track-origins=yes
--2801434--    --errors-for-leak-kinds=definite
--2801434--    --verbose
--2801434--    --log-file=valgrind-out.txt
--2801434-- Contents of /proc/version:
--2801434--   Linux version 5.4.0-182-generic (buildd@lcy02-amd64-069) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.2)) #202-Ubuntu SMP Fri Apr 26 12:29:36 UTC 2024
--2801434--
--2801434-- Arch and hwcaps: AMD64, LittleEndian, amd64-cx16-lzcnt-rdtscp-sse3-ssse3-avx-avx2-bmi-f16c-rdrand
--2801434-- Page sizes: currently 4096, max supported 4096
--2801434-- Valgrind library directory: /usr/lib/x86_64-linux-gnu/valgrind
--2801434-- Reading syms from /home/nalfaro/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/server/aesdsocket
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/ld-2.31.so
--2801434--   Considering /usr/lib/debug/.build-id/c9/a47e328eb2f1f41bcbcf31f9c11b9e17aa2a83.debug ..
--2801434--   .. build-id is valid
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/valgrind/memcheck-amd64-linux
--2801434--    object doesn't have a symbol table
--2801434--    object doesn't have a dynamic symbol table
--2801434-- Scheduler: using generic scheduler lock implementation.
--2801434-- Reading suppressions file: /usr/lib/x86_64-linux-gnu/valgrind/default.supp
==2801434== embedded gdbserver: reading from /tmp/vgdb-pipe-from-vgdb-to-2801434-by-nalfaro-on-???
==2801434== embedded gdbserver: writing to   /tmp/vgdb-pipe-to-vgdb-from-2801434-by-nalfaro-on-???
==2801434== embedded gdbserver: shared mem   /tmp/vgdb-pipe-shared-mem-vgdb-2801434-by-nalfaro-on-???
==2801434==
==2801434== TO CONTROL THIS PROCESS USING vgdb (which you probably
==2801434== don't want to do, unless you know exactly what you're doing,
==2801434== or are doing some strange experiment):
==2801434==   /usr/lib/x86_64-linux-gnu/valgrind/../../bin/vgdb --pid=2801434 ...command...
==2801434==
==2801434== TO DEBUG THIS PROCESS USING GDB: start GDB like this
==2801434==   /path/to/gdb ./aesdsocket
==2801434== and then give GDB the following command
==2801434==   target remote | /usr/lib/x86_64-linux-gnu/valgrind/../../bin/vgdb --pid=2801434
==2801434== --pid is optional if only one valgrind process is running
==2801434==
--2801434-- REDIR: 0x4022e20 (ld-linux-x86-64.so.2:strlen) redirected to 0x580c9ce2 (???)
--2801434-- REDIR: 0x4022bf0 (ld-linux-x86-64.so.2:index) redirected to 0x580c9cfc (???)
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_core-amd64-linux.so
--2801434--    object doesn't have a symbol table
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so
--2801434--    object doesn't have a symbol table
==2801434== WARNING: new redirection conflicts with existing -- ignoring it
--2801434--     old: 0x04022e20 (strlen              ) R-> (0000.0) 0x580c9ce2 ???
--2801434--     new: 0x04022e20 (strlen              ) R-> (2007.0) 0x0483f060 strlen
--2801434-- REDIR: 0x401f600 (ld-linux-x86-64.so.2:strcmp) redirected to 0x483ffd0 (strcmp)
--2801434-- REDIR: 0x4023380 (ld-linux-x86-64.so.2:mempcpy) redirected to 0x4843a20 (mempcpy)
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
--2801434--   Considering /usr/lib/debug/.build-id/c6/d0d79d906d62bb768421fc6dada0d5e729f177.debug ..
--2801434--   .. build-id is valid
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/libc-2.31.so
--2801434--   Considering /usr/lib/debug/.build-id/87/b331c034a6458c64ce09c03939e947212e18ce.debug ..
--2801434--   .. build-id is valid
--2801434-- REDIR: 0x491b480 (libc.so.6:memmove) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a780 (libc.so.6:strncpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b7b0 (libc.so.6:strcasecmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a0a0 (libc.so.6:strcat) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a7e0 (libc.so.6:rindex) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491cc50 (libc.so.6:rawmemchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937ce0 (libc.so.6:wmemchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937820 (libc.so.6:wcscmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b5e0 (libc.so.6:mempcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b410 (libc.so.6:bcmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a710 (libc.so.6:strncmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a150 (libc.so.6:strcmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b540 (libc.so.6:memset) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x49377e0 (libc.so.6:wcschr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a670 (libc.so.6:strnlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a230 (libc.so.6:strcspn) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b800 (libc.so.6:strncasecmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a1d0 (libc.so.6:strcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b950 (libc.so.6:memcpy@@GLIBC_2.14) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4938f50 (libc.so.6:wcsnlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937860 (libc.so.6:wcscpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a820 (libc.so.6:strpbrk) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a100 (libc.so.6:index) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a630 (libc.so.6:strlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4923bb0 (libc.so.6:memrchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b850 (libc.so.6:strcasecmp_l) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b3d0 (libc.so.6:memchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937930 (libc.so.6:wcslen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491aae0 (libc.so.6:strspn) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b750 (libc.so.6:stpncpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b6f0 (libc.so.6:stpcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491cc90 (libc.so.6:strchrnul) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b8a0 (libc.so.6:strncasecmp_l) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4a03730 (libc.so.6:__strrchr_avx2) redirected to 0x483ea10 (rindex)
--2801434-- REDIR: 0x4a03900 (libc.so.6:__strlen_avx2) redirected to 0x483ef40 (strlen)
--2801434-- REDIR: 0x4a06d90 (libc.so.6:__memset_avx2_unaligned_erms) redirected to 0x48428e0 (memset)
--2801434-- REDIR: 0x49150e0 (libc.so.6:malloc) redirected to 0x483b780 (malloc)
--2801434-- REDIR: 0x4916b10 (libc.so.6:calloc) redirected to 0x483dce0 (calloc)
--2801434-- REDIR: 0x4a03540 (libc.so.6:__strchrnul_avx2) redirected to 0x4843540 (strchrnul)
--2801434-- REDIR: 0x49156d0 (libc.so.6:free) redirected to 0x483c9d0 (free)
--2801434-- REDIR: 0x4a06910 (libc.so.6:__memcpy_avx_unaligned_erms) redirected to 0x48429f0 (memmove)
--2801434-- REDIR: 0x491afa0 (libc.so.6:__GI_strstr) redirected to 0x4843ca0 (__strstr_sse2)
--2801434-- REDIR: 0x49ffef0 (libc.so.6:__memcmp_avx2_movbe) redirected to 0x48421e0 (bcmp)
--2801434-- REDIR: 0x49fedf0 (libc.so.6:__strcmp_avx2) redirected to 0x483fed0 (strcmp)
--2801434-- REDIR: 0x4a068f0 (libc.so.6:__mempcpy_avx_unaligned_erms) redirected to 0x4843660 (mempcpy)
--2801434-- REDIR: 0x4915e80 (libc.so.6:realloc) redirected to 0x483df30 (realloc)
--2801434-- REDIR: 0x4a03310 (libc.so.6:__strchr_avx2) redirected to 0x483ebf0 (index)
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/libgcc_s.so.1
--2801434--    object doesn't have a symbol table
==2801434== Invalid read of size 8
==2801434==    at 0x10ABC9: sig_handler (aesdsocket.c:135)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid read of size 8
==2801434==    at 0x10ABE9: sig_handler (aesdsocket.c:138)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid read of size 8
==2801434==    at 0x10AC10: sig_handler (aesdsocket.c:141)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a70200 is 16 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid read of size 4
==2801434==    at 0x10AC1F: sig_handler (aesdsocket.c:142)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f8 is 8 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid free() / delete / delete[] / realloc()
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AC34: sig_handler (aesdsocket.c:143)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
--2801434-- Discarding syms at 0x56745e0-0x5685055 in /usr/lib/x86_64-linux-gnu/libgcc_s.so.1 (have_dinfo 1)
==2801434==
==2801434== HEAP SUMMARY:
==2801434==     in use at exit: 24 bytes in 1 blocks
==2801434==   total heap usage: 48 allocs, 49 frees, 90,333 bytes allocated
==2801434==
==2801434== Searching for pointers to 1 not-freed blocks
==2801434== Checked 91,376 bytes
==2801434==
==2801434== 24 bytes in 1 blocks are still reachable in loss record 1 of 1
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== LEAK SUMMARY:
==2801434==    definitely lost: 0 bytes in 0 blocks
==2801434==    indirectly lost: 0 bytes in 0 blocks
==2801434==      possibly lost: 0 bytes in 0 blocks
==2801434==    still reachable: 24 bytes in 1 blocks
==2801434==         suppressed: 0 bytes in 0 blocks
==2801434==
==2801434== ERROR SUMMARY: 10 errors from 5 contexts (suppressed: 0 from 0)
==2801434==
==2801434== 2 errors in context 1 of 5:
==2801434== Invalid free() / delete / delete[] / realloc()
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AC34: sig_handler (aesdsocket.c:143)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 2 of 5:
==2801434== Invalid read of size 4
==2801434==    at 0x10AC1F: sig_handler (aesdsocket.c:142)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f8 is 8 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 3 of 5:
==2801434== Invalid read of size 8
==2801434==    at 0x10AC10: sig_handler (aesdsocket.c:141)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a70200 is 16 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 4 of 5:
==2801434== Invalid read of size 8
==2801434==    at 0x10ABE9: sig_handler (aesdsocket.c:138)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 5 of 5:
==2801434== Invalid read of size 8
==2801434==    at 0x10ABC9: sig_handler (aesdsocket.c:135)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== ERROR SUMMARY: 10 errors from 5 contexts (suppressed: 0 from 0)
deleting marker file /tmp/tmp.60XxX0iaxa
Validation failed with error list :sockettest.sh returned 1 attempting to run against native compiled aesdsocket instance:sockettest.sh returned 1 attempting to run against native compiled aesdsocket instance running under valgrind
Test of assignment assignment6 failed with rc=1



















After making the changes and thus resulting:
```aesdsocket.h
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/time.h>
#include <unistd.h>
#include <netinet/in.h>
#include <sys/syslog.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <arpa/inet.h>
#include <getopt.h> // for cli args parsing
#include <pthread.h>
#include <sys/queue.h>
#include <stdbool.h>

#define PORT 9000
#define DATA_FILE "/var/tmp/aesdsocketdata"

void daemonize();
void *add_timestamp(void* arg);
void *connection_handler (void* thread_arg);
void sig_handler(int signo);
```

```aesdsocket.c
#include "aesdsocket.h"
// #include "queue.h"
// #include <pthread.h>
// #include <stdio.h>
// #include <stdlib.h>
// #include <sys/time.h>
// #include <time.h>

int server_socketfd;
int client_socketfd;
bool daemon_mode = false;
pthread_mutex_t mutex;

// linked list for threads
struct slist_thread {
  pthread_t thread;
  int client_socketfd;
  SLIST_ENTRY(slist_thread) entries;
};
SLIST_HEAD(slisthead, slist_thread) head;

int main(int argc, char *argv[]) {
  openlog("aesdsocket", LOG_CONS | LOG_PID | LOG_NDELAY | LOG_PERROR, LOG_LOCAL1);
  int opt;

  // parse cli args
  while ((opt = getopt(argc, argv, "d")) != -1) {
    switch (opt) {
      case 'd':
        daemon_mode = true;
        break;
      default:
        fprintf(stderr, "Usage: %s [-d]\n", argv[0]);
        exit(EXIT_FAILURE);
    }
  }

  // signal handler setup
  struct sigaction sigact;
  sigact.sa_handler = sig_handler;
  sigemptyset(&sigact.sa_mask);
  sigact.sa_flags = 0;
  sigaction(SIGINT, &sigact, NULL);
  sigaction(SIGTERM, &sigact, NULL);
  sigaction(SIGALRM, &sigact, NULL);

  // timer for periodic timestamps
  struct itimerval timer;
  timer.it_value.tv_sec = 10;
  timer.it_value.tv_usec = 0;
  timer.it_interval.tv_sec = 10;
  timer.it_interval.tv_usec = 0;
  if (setitimer(ITIMER_REAL, &timer, NULL) < 0) {
    perror("setitimer");
    exit(EXIT_FAILURE);
  }

  // 0. socket step: establishing connection
  server_socketfd = socket(PF_INET, SOCK_STREAM, 0);
  if (server_socketfd < 0) {
    perror("socket");
    exit(EXIT_FAILURE);
  }
  // handle `bind: Address alredy in use`: https://stackoverflow.com/questions/24194961/how-do-i-use-setsockoptso-reuseaddr
  if (setsockopt(server_socketfd, SOL_SOCKET, SO_REUSEADDR, &(int){1}, sizeof(int)) < 0) {
    perror("setsockopt(SO_REUSEADDR)");
    exit(EXIT_FAILURE);
  }

  // 1. bind step: assign address to the socket
  struct sockaddr_in server_address;
  memset(&server_address, 0, sizeof(server_address)); // initialize the struct to zero
  server_address.sin_family = AF_INET;
  server_address.sin_port = htons(PORT);
  server_address.sin_addr.s_addr = INADDR_ANY;
  if (bind(server_socketfd, (struct sockaddr *)&server_address, sizeof(server_address)) < 0)  {
    perror("bind");
    exit(EXIT_FAILURE);
  }

  // 2. listen step: initialize socket for incoming connections
  if (listen(server_socketfd, 5) < 0) {
    perror("listen");
    exit(EXIT_FAILURE);
  }

  if (pthread_mutex_init(&mutex, NULL) != 0) {
    perror("pthread_mutex_init");
    exit(EXIT_FAILURE);
  }

  if (daemon_mode) {
    daemonize(); // convert the server to a daemon
  }

  // 3. accept/handle step:
  SLIST_INIT(&head);
  // pthread_t timestamp_thread;
  // if (pthread_create(&timestamp_thread, NULL, add_timestamp, NULL) != 0) {
  //   perror("pthread_create");
  //   exit(EXIT_FAILURE);
  // }
  while (1) {
    struct slist_thread *thread_entry = (struct slist_thread *)malloc(sizeof(struct slist_thread));
    if (thread_entry == NULL) {
      perror("thread_entry malloc");
      exit(EXIT_FAILURE);
    }

    struct sockaddr_in client_address;
    socklen_t client_address_size = sizeof(struct sockaddr_in);
    if ((thread_entry->client_socketfd = accept(server_socketfd, (struct sockaddr *)&client_address, &client_address_size)) == -1) {
      perror("accept");
      free(thread_entry);
      continue;
    }

    if (pthread_create(&thread_entry->thread, NULL, connection_handler, thread_entry) != 0) {
      perror("pthread_create");
      close(thread_entry->client_socketfd);
      free(thread_entry);
      continue;
    }
    SLIST_INSERT_HEAD(&head, thread_entry, entries);
  }
  close(server_socketfd);
  return 0;
}

void sig_handler(int signo) {
  if (signo == SIGINT || signo == SIGTERM) {
    struct slist_thread *thread_entry;
    while (!SLIST_EMPTY(&head)) {
      thread_entry = SLIST_FIRST(&head);
      if (pthread_cancel(thread_entry->thread) == -1) {
        perror("pthread_cancel");
      }
      if (pthread_join(thread_entry->thread, NULL) != 0) {
        perror("pthread_join");
      }
      SLIST_REMOVE_HEAD(&head, entries);
      close(thread_entry->client_socketfd);
      free(thread_entry);
    }
    close(server_socketfd);
    pthread_mutex_destroy(&mutex);
    remove(DATA_FILE);
    syslog(LOG_INFO, "Caught signal, exiting");
    closelog();
    exit(EXIT_SUCCESS);
  }
  else if (signo == SIGALRM) {
    pthread_mutex_lock(&mutex);
    FILE *data_file = fopen(DATA_FILE, "a");
    if (data_file != NULL) {
      time_t current_time;
      struct tm *time_info;
      char timestamp_str[64];
      time(&current_time);
      time_info = localtime(&current_time);
      strftime(timestamp_str, sizeof(timestamp_str), "timestamp:%a, %d %b %Y %H:%M:%S %z\n", time_info);
      fprintf(data_file, "%s", timestamp_str);
      fclose(data_file);
    }
    pthread_mutex_unlock(&mutex);
  }
}

void *connection_handler (void* thread_arg) {
  struct slist_thread *thread_entry = (struct slist_thread*)thread_arg;
  struct sockaddr_in client_address;
  socklen_t client_address_size = sizeof(client_address);
  if (getpeername(thread_entry->client_socketfd, (struct sockaddr *)&client_address, &client_address_size) == 0) {
    syslog(LOG_INFO, "Accepted connection from %s\n", inet_ntoa(client_address.sin_addr));
  }

  ssize_t bytes_received;
  size_t buffer_size = 1024; // initial buffer size
  char *buffer = malloc(buffer_size); // allocate initial buffer
  if (buffer == NULL) {
    perror("buffer malloc");
    close(thread_entry->client_socketfd);
    free(thread_entry);
    pthread_exit(NULL);
  }

  size_t total_bytes_received = 0;

  while ((bytes_received = recv(thread_entry->client_socketfd, buffer + total_bytes_received, buffer_size - total_bytes_received, 0)) > 0) {
    total_bytes_received += bytes_received;
    // if buffer is full
    if (total_bytes_received == buffer_size) {
      // double the buffer size
      buffer_size *= 2;
      buffer = realloc(buffer, buffer_size); // resize buffer
      if (buffer == NULL) {
        perror("realloc");
        close(thread_entry->client_socketfd);
        free(thread_entry);
        pthread_exit(NULL);
      }
    }

    // check for newline to consider packet complete
    char *newline = strchr(buffer, '\n');
    if (newline != NULL) {
      syslog(LOG_INFO, "Received full data packet from %s", inet_ntoa(client_address.sin_addr));
      // write only up to the newline character
      size_t bytes_to_write = newline - buffer + 1; // include the newline character

      pthread_mutex_lock(&mutex);
      // printf("Buffer content: ");
      // for (size_t i = 0; i < total_bytes_received; ++i) {
      //   putchar(buffer[i]);
      // }
      // printf("\n");
      FILE *data_file_a = fopen(DATA_FILE, "a");
      // printf("FIRST connection_handler: %d\n", fileno(data_file));
      if (data_file_a == NULL) {
        perror("fopen");
        pthread_mutex_unlock(&mutex);
        close(thread_entry->client_socketfd);
        free(buffer);
        free(thread_entry);
        pthread_exit(NULL);
      }
      fwrite(buffer, 1, bytes_to_write, data_file_a);
      fclose(data_file_a);

      // send the data back
      FILE *data_file = fopen(DATA_FILE, "r");
      // printf("SECOND connection_handler: %d\n", fileno(data_file));
      if (data_file == NULL) {
        perror("fopen");
        pthread_mutex_unlock(&mutex);
        close(thread_entry->client_socketfd);
        free(buffer);
        free(thread_entry);
        pthread_exit(NULL);
      }

      // calculate file size
      fseek(data_file, 0, SEEK_END);
      long file_size = ftell(data_file);
      rewind(data_file);

      // read content
      char *file_content = malloc(file_size);
      if (file_content == NULL) {
        perror("file_content malloc");
        fclose(data_file);
        pthread_mutex_unlock(&mutex);
        close(thread_entry->client_socketfd);
        free(buffer);
        free(thread_entry);
        pthread_exit(NULL);
      }
      fread(file_content, 1, file_size, data_file);
      fclose(data_file);

      // send to client
      // printf("Sending content: ");
      // for (size_t i = 0; i < file_size; ++i) {
      //   putchar(file_content[i]);
      // }
      // printf("\n");
      send(thread_entry->client_socketfd, file_content, file_size, 0);
      free(file_content);
      pthread_mutex_unlock(&mutex);
      // break;
    }
  }




  // old packet handling
  // while ((bytes_received = recv(thread_entry->client_socketfd, buffer + total_bytes_received, buffer_size - total_bytes_received, 0))) {
  //   if (bytes_received < 0) {
  //     perror("recv");
  //     exit(EXIT_FAILURE);
  //   }
  //   total_bytes_received += bytes_received;
  //
  //   // if buffer is full
  //   if (total_bytes_received == buffer_size) {
  //     // double the buffer size
  //     buffer_size *= 2;
  //     buffer = realloc(buffer, buffer_size); // resize buffer
  //     if (buffer == NULL) {
  //       perror("realloc");
  //       exit(EXIT_FAILURE);
  //     }
  //
  //     // initialize the newly allocated memory
  //     memset(buffer + total_bytes_received, 0, buffer_size - total_bytes_received);
  //   }
  //
  //   // check for newline to consider packet complete
  //   char *newline = strchr(buffer, '\n');
  //   if (newline != NULL) {
  //     syslog(LOG_INFO, "Received full data packet from %s", inet_ntoa(client_address.sin_addr));
  //     // write only up to the newline character
  //     size_t bytes_to_write = newline - buffer + 1; // include the newline character
  //     pthread_mutex_lock(&mutex);
  //
  //     printf("Buffer content: ");
  //     for (size_t i = 0; i < total_bytes_received; ++i) {
  //       putchar(buffer[i]);
  //     }
  //     printf("\n");
  //     FILE *data_file_a = fopen(DATA_FILE, "a");
  //     // printf("FIRST connection_handler: %d\n", fileno(data_file));
  //     if (data_file_a == NULL) {
  //       perror("fopen");
  //       exit(EXIT_FAILURE);
  //     }
  //     fwrite(buffer, 1, bytes_to_write, data_file_a);
  //     fclose(data_file_a);
  //
  //     // send the data back
  //     FILE *data_file = fopen(DATA_FILE, "r");
  //     // printf("SECOND connection_handler: %d\n", fileno(data_file));
  //     if (data_file == NULL) {
  //       perror("fopen");
  //       exit(EXIT_FAILURE);
  //     }
  //
  //     // calculate file size
  //     fseek(data_file, 0, SEEK_END);
  //     long file_size = ftell(data_file);
  //     rewind(data_file);
  //
  //     // read content
  //     char *file_content = malloc(file_size);
  //     if (file_content == NULL) {
  //       perror("file_content malloc");
  //       exit(EXIT_FAILURE);
  //     }
  //     fread(file_content, 1, file_size, data_file);
  //     fclose(data_file);
  //
  //     // send to client
  //     printf("Sending content: ");
  //     for (size_t i = 0; i < file_size; ++i) {
  //       putchar(file_content[i]);
  //     }
  //     printf("\n");
  //     send(thread_entry->client_socketfd, file_content, file_size, 0);
  //     free(file_content);
  //     pthread_mutex_unlock(&mutex);
  //     // break;
  //   }
  // }

  // return data to client
  // pthread_mutex_lock(&mutex);

  // clean up
  close(thread_entry->client_socketfd);
  free(buffer);
  free(thread_entry);
  // pthread_mutex_unlock(&mutex);
  syslog(LOG_INFO, "Closed connection from %s", inet_ntoa(client_address.sin_addr));
  pthread_exit(NULL);
}

void daemonize() {
  pid_t pid;

  // fork off the parent process
  pid = fork();
  if (pid < 0) {
    perror("fork");
    exit(EXIT_FAILURE);
  }

  // if we got a PID
  if (pid > 0) {
    // exit parent process
    exit(EXIT_SUCCESS);
  }

  // change the file mode mask
  umask(0);

  // create a new SID for the child process
  if (setsid() < 0) {
    perror("setsid");
    exit(EXIT_FAILURE);
  }
  // change the current working directory to root
  if (chdir("/") < 0) {
    perror("chdir");
    exit(EXIT_FAILURE);
  }
  // close the standard file descriptors
  close(STDIN_FILENO);
  close(STDOUT_FILENO);
  close(STDERR_FILENO);
}
```

It is now failing with:
```
timestamp:wait-for-startup
Re-running sockettest.sh with valgrind
~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/server ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/assignment-autotest/test/assignment6 ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro
~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/assignment-autotest/test/assignment6 ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/server ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/assignment-autotest/test/assignment6 ~/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro
Starting valgrind
Waiting for aesdsocket application to start
aesdsocket[2801434]: Accepted connection from 127.0.0.1
aesdsocket[2801434]: Received full data packet from 127.0.0.1
timestamp:wait-for-startup
aesdsocket[2801434]: Closed connection from 127.0.0.1
Testing target localhost on port 9000
sending string abcdefg
aesdsocket[2801434]: Accepted connection from 127.0.0.1
aesdsocket[2801434]: Received full data packet from 127.0.0.1
aesdsocket[2801434]: Closed connection from 127.0.0.1
Differences found after sending abcdefg to localhost on port 9000
Expected contents to match:
abcdefg
But found contents:
abcdefg
hijklmnop
1234567890
9876543210
One best book is equal to a hundred good friends, but one good friend is equal to a library
If you want to shine like a sun, first burn like a sun
Never stop fighting until you arrive at your destined place - that is, the unique you
Never stop fighting until you arrive at your destined place - that is, the unique you
One best book is equal to a hundred good friends, but one good friend is equal to a library
One best book is equal to a hundred good friends, but one good friend is equal to a library
If you want to shine like a sun, first burn like a sun
Never stop fighting until you arrive at your destined place - that is, the unique you
If you want to shine like a sun, first burn like a sun
validate_multithreaded
test_socket_timer
test_socket_timer
timestamp:wait-for-startup
abcdefg
With differences
--- /tmp/fileuaxG2Z     2024-05-22 00:17:52.542392186 +0000
+++ /tmp/fileQF59NO     2024-05-22 00:17:51.530405578 +0000
@@ -1 +1,18 @@
 abcdefg
+hijklmnop
+1234567890
+9876543210
+One best book is equal to a hundred good friends, but one good friend is equal to a library
+If you want to shine like a sun, first burn like a sun
+Never stop fighting until you arrive at your destined place - that is, the unique you
+Never stop fighting until you arrive at your destined place - that is, the unique you
+One best book is equal to a hundred good friends, but one good friend is equal to a library
+One best book is equal to a hundred good friends, but one good friend is equal to a library
+If you want to shine like a sun, first burn like a sun
+Never stop fighting until you arrive at your destined place - that is, the unique you
+If you want to shine like a sun, first burn like a sun
+validate_multithreaded
+test_socket_timer
+test_socket_timer
+timestamp:wait-for-startup
+abcdefg
Test complete with failure. Make sure you have restarted the socket server before starting this script
Validation Error:sockettest.sh returned 1 attempting to run against native compiled aesdsocket instance running under valgrind
Stopping valgrind and aesdsocket process at pid 2801434
Waiting for aesdsocket and valgrind to exit
aesdsocket[2801434]: Caught signal, exiting
Valgrind and aesdsocket complete
Validation Error:Valgrind failed with 1
Valgrind output error log:
==2801434== Memcheck, a memory error detector
==2801434== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==2801434== Using Valgrind-3.15.0-608cb11914-20190413 and LibVEX; rerun with -h for copyright info
==2801434== Command: ./aesdsocket
==2801434== Parent PID: 2801432
==2801434==
--2801434--
--2801434-- Valgrind options:
--2801434--    --error-exitcode=1
--2801434--    --leak-check=full
--2801434--    --show-leak-kinds=all
--2801434--    --track-origins=yes
--2801434--    --errors-for-leak-kinds=definite
--2801434--    --verbose
--2801434--    --log-file=valgrind-out.txt
--2801434-- Contents of /proc/version:
--2801434--   Linux version 5.4.0-182-generic (buildd@lcy02-amd64-069) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.2)) #202-Ubuntu SMP Fri Apr 26 12:29:36 UTC 2024
--2801434--
--2801434-- Arch and hwcaps: AMD64, LittleEndian, amd64-cx16-lzcnt-rdtscp-sse3-ssse3-avx-avx2-bmi-f16c-rdrand
--2801434-- Page sizes: currently 4096, max supported 4096
--2801434-- Valgrind library directory: /usr/lib/x86_64-linux-gnu/valgrind
--2801434-- Reading syms from /home/nalfaro/msee/Advanced_Embedded_Linux_Development/ECEA_5305/assignments-3-and-later-nestoralfaro/server/aesdsocket
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/ld-2.31.so
--2801434--   Considering /usr/lib/debug/.build-id/c9/a47e328eb2f1f41bcbcf31f9c11b9e17aa2a83.debug ..
--2801434--   .. build-id is valid
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/valgrind/memcheck-amd64-linux
--2801434--    object doesn't have a symbol table
--2801434--    object doesn't have a dynamic symbol table
--2801434-- Scheduler: using generic scheduler lock implementation.
--2801434-- Reading suppressions file: /usr/lib/x86_64-linux-gnu/valgrind/default.supp
==2801434== embedded gdbserver: reading from /tmp/vgdb-pipe-from-vgdb-to-2801434-by-nalfaro-on-???
==2801434== embedded gdbserver: writing to   /tmp/vgdb-pipe-to-vgdb-from-2801434-by-nalfaro-on-???
==2801434== embedded gdbserver: shared mem   /tmp/vgdb-pipe-shared-mem-vgdb-2801434-by-nalfaro-on-???
==2801434==
==2801434== TO CONTROL THIS PROCESS USING vgdb (which you probably
==2801434== don't want to do, unless you know exactly what you're doing,
==2801434== or are doing some strange experiment):
==2801434==   /usr/lib/x86_64-linux-gnu/valgrind/../../bin/vgdb --pid=2801434 ...command...
==2801434==
==2801434== TO DEBUG THIS PROCESS USING GDB: start GDB like this
==2801434==   /path/to/gdb ./aesdsocket
==2801434== and then give GDB the following command
==2801434==   target remote | /usr/lib/x86_64-linux-gnu/valgrind/../../bin/vgdb --pid=2801434
==2801434== --pid is optional if only one valgrind process is running
==2801434==
--2801434-- REDIR: 0x4022e20 (ld-linux-x86-64.so.2:strlen) redirected to 0x580c9ce2 (???)
--2801434-- REDIR: 0x4022bf0 (ld-linux-x86-64.so.2:index) redirected to 0x580c9cfc (???)
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_core-amd64-linux.so
--2801434--    object doesn't have a symbol table
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so
--2801434--    object doesn't have a symbol table
==2801434== WARNING: new redirection conflicts with existing -- ignoring it
--2801434--     old: 0x04022e20 (strlen              ) R-> (0000.0) 0x580c9ce2 ???
--2801434--     new: 0x04022e20 (strlen              ) R-> (2007.0) 0x0483f060 strlen
--2801434-- REDIR: 0x401f600 (ld-linux-x86-64.so.2:strcmp) redirected to 0x483ffd0 (strcmp)
--2801434-- REDIR: 0x4023380 (ld-linux-x86-64.so.2:mempcpy) redirected to 0x4843a20 (mempcpy)
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
--2801434--   Considering /usr/lib/debug/.build-id/c6/d0d79d906d62bb768421fc6dada0d5e729f177.debug ..
--2801434--   .. build-id is valid
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/libc-2.31.so
--2801434--   Considering /usr/lib/debug/.build-id/87/b331c034a6458c64ce09c03939e947212e18ce.debug ..
--2801434--   .. build-id is valid
--2801434-- REDIR: 0x491b480 (libc.so.6:memmove) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a780 (libc.so.6:strncpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b7b0 (libc.so.6:strcasecmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a0a0 (libc.so.6:strcat) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a7e0 (libc.so.6:rindex) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491cc50 (libc.so.6:rawmemchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937ce0 (libc.so.6:wmemchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937820 (libc.so.6:wcscmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b5e0 (libc.so.6:mempcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b410 (libc.so.6:bcmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a710 (libc.so.6:strncmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a150 (libc.so.6:strcmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b540 (libc.so.6:memset) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x49377e0 (libc.so.6:wcschr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a670 (libc.so.6:strnlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a230 (libc.so.6:strcspn) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b800 (libc.so.6:strncasecmp) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a1d0 (libc.so.6:strcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b950 (libc.so.6:memcpy@@GLIBC_2.14) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4938f50 (libc.so.6:wcsnlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937860 (libc.so.6:wcscpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a820 (libc.so.6:strpbrk) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a100 (libc.so.6:index) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491a630 (libc.so.6:strlen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4923bb0 (libc.so.6:memrchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b850 (libc.so.6:strcasecmp_l) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b3d0 (libc.so.6:memchr) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4937930 (libc.so.6:wcslen) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491aae0 (libc.so.6:strspn) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b750 (libc.so.6:stpncpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b6f0 (libc.so.6:stpcpy) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491cc90 (libc.so.6:strchrnul) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x491b8a0 (libc.so.6:strncasecmp_l) redirected to 0x48311d0 (_vgnU_ifunc_wrapper)
--2801434-- REDIR: 0x4a03730 (libc.so.6:__strrchr_avx2) redirected to 0x483ea10 (rindex)
--2801434-- REDIR: 0x4a03900 (libc.so.6:__strlen_avx2) redirected to 0x483ef40 (strlen)
--2801434-- REDIR: 0x4a06d90 (libc.so.6:__memset_avx2_unaligned_erms) redirected to 0x48428e0 (memset)
--2801434-- REDIR: 0x49150e0 (libc.so.6:malloc) redirected to 0x483b780 (malloc)
--2801434-- REDIR: 0x4916b10 (libc.so.6:calloc) redirected to 0x483dce0 (calloc)
--2801434-- REDIR: 0x4a03540 (libc.so.6:__strchrnul_avx2) redirected to 0x4843540 (strchrnul)
--2801434-- REDIR: 0x49156d0 (libc.so.6:free) redirected to 0x483c9d0 (free)
--2801434-- REDIR: 0x4a06910 (libc.so.6:__memcpy_avx_unaligned_erms) redirected to 0x48429f0 (memmove)
--2801434-- REDIR: 0x491afa0 (libc.so.6:__GI_strstr) redirected to 0x4843ca0 (__strstr_sse2)
--2801434-- REDIR: 0x49ffef0 (libc.so.6:__memcmp_avx2_movbe) redirected to 0x48421e0 (bcmp)
--2801434-- REDIR: 0x49fedf0 (libc.so.6:__strcmp_avx2) redirected to 0x483fed0 (strcmp)
--2801434-- REDIR: 0x4a068f0 (libc.so.6:__mempcpy_avx_unaligned_erms) redirected to 0x4843660 (mempcpy)
--2801434-- REDIR: 0x4915e80 (libc.so.6:realloc) redirected to 0x483df30 (realloc)
--2801434-- REDIR: 0x4a03310 (libc.so.6:__strchr_avx2) redirected to 0x483ebf0 (index)
--2801434-- Reading syms from /usr/lib/x86_64-linux-gnu/libgcc_s.so.1
--2801434--    object doesn't have a symbol table
==2801434== Invalid read of size 8
==2801434==    at 0x10ABC9: sig_handler (aesdsocket.c:135)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid read of size 8
==2801434==    at 0x10ABE9: sig_handler (aesdsocket.c:138)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid read of size 8
==2801434==    at 0x10AC10: sig_handler (aesdsocket.c:141)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a70200 is 16 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid read of size 4
==2801434==    at 0x10AC1F: sig_handler (aesdsocket.c:142)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f8 is 8 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== Invalid free() / delete / delete[] / realloc()
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AC34: sig_handler (aesdsocket.c:143)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
--2801434-- Discarding syms at 0x56745e0-0x5685055 in /usr/lib/x86_64-linux-gnu/libgcc_s.so.1 (have_dinfo 1)
==2801434==
==2801434== HEAP SUMMARY:
==2801434==     in use at exit: 24 bytes in 1 blocks
==2801434==   total heap usage: 48 allocs, 49 frees, 90,333 bytes allocated
==2801434==
==2801434== Searching for pointers to 1 not-freed blocks
==2801434== Checked 91,376 bytes
==2801434==
==2801434== 24 bytes in 1 blocks are still reachable in loss record 1 of 1
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== LEAK SUMMARY:
==2801434==    definitely lost: 0 bytes in 0 blocks
==2801434==    indirectly lost: 0 bytes in 0 blocks
==2801434==      possibly lost: 0 bytes in 0 blocks
==2801434==    still reachable: 24 bytes in 1 blocks
==2801434==         suppressed: 0 bytes in 0 blocks
==2801434==
==2801434== ERROR SUMMARY: 10 errors from 5 contexts (suppressed: 0 from 0)
==2801434==
==2801434== 2 errors in context 1 of 5:
==2801434== Invalid free() / delete / delete[] / realloc()
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AC34: sig_handler (aesdsocket.c:143)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 2 of 5:
==2801434== Invalid read of size 4
==2801434==    at 0x10AC1F: sig_handler (aesdsocket.c:142)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f8 is 8 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 3 of 5:
==2801434== Invalid read of size 8
==2801434==    at 0x10AC10: sig_handler (aesdsocket.c:141)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a70200 is 16 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 4 of 5:
==2801434== Invalid read of size 8
==2801434==    at 0x10ABE9: sig_handler (aesdsocket.c:138)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434==
==2801434== 2 errors in context 5 of 5:
==2801434== Invalid read of size 8
==2801434==    at 0x10ABC9: sig_handler (aesdsocket.c:135)
==2801434==    by 0x486C41F: ??? (in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so)
==2801434==    by 0x486B4FE: accept (accept.c:26)
==2801434==    by 0x10AAD3: main (aesdsocket.c:112)
==2801434==  Address 0x4a701f0 is 0 bytes inside a block of size 24 free'd
==2801434==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10B11A: connection_handler (aesdsocket.c:362)
==2801434==    by 0x4860608: start_thread (pthread_create.c:477)
==2801434==    by 0x499A352: clone (clone.S:95)
==2801434==  Block was alloc'd at
==2801434==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==2801434==    by 0x10AA84: main (aesdsocket.c:104)
==2801434==
==2801434== ERROR SUMMARY: 10 errors from 5 contexts (suppressed: 0 from 0)
deleting marker file /tmp/tmp.60XxX0iaxa
Validation failed with error list :sockettest.sh returned 1 attempting to run against native compiled aesdsocket instance:sockettest.sh returned 1 attempting to run against native compiled aesdsocket instance running under valgrind
Test of assignment assignment6 failed with rc=1
```
